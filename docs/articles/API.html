<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The NWM Reanalysis API • National Water Model</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../bootstrap.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../mikepkgdown.css" rel="stylesheet">
<meta property="og:title" content="The NWM Reanalysis API">
<meta property="og:description" content="nwmHistoric">
<meta property="og:image" content="https://github.com/mikejohnson51/nwmHistoric/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
                                                                          <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
                                                                            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
                                                                              <![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
              <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                  </button>
                  
                  <div class="navbar-brand-container">
                    <a class="navbar-brand" href="../index.html">nwmHistoric</a>
                      <div class="info">
                        <span class="partof">National Water Model</span>
                          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
                            </div>
                              </div>
                              </div>
                              <div id="navbar" class="navbar-collapse collapse">
                                <ul class="nav navbar-nav navbar-left">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/API.html">API</a>
    </li>
    <li>
      <a href="../articles/Getting_Data.html">Getting Data</a>
    </li>
    <li>
      <a href="../articles/aggregate.html">Data Aggregators</a>
    </li>
  </ul>
</li>
                                </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mikejohnson51/nwmHistoric/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
                                </ul>
</div>
<!--/.nav-collapse -->
                                          </div>
<!--/.container -->
                                          </div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The NWM Reanalysis API</h1>
                        <h4 class="author"><a href="mailto:jmj00@ucsb.edu" class="email">jmj00@ucsb.edu</a></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikejohnson51/nwmHistoric/blob/master/vignettes/API.Rmd"><code>vignettes/API.Rmd</code></a></small>
      <div class="hidden name"><code>API.Rmd</code></div>

    </div>

    
    
<p>As part of a collaborative research effort, the multi-decadal reanalysis products from the <a href="https://water.noaa.gov/about/nwm">NOAA National Water Model</a> (versions 1.2 and 2.0) have been reformatted and exposed through <a href="https://www.cuahsi.org/">CUAHSI</a> at the <a href="https://renci.org/research/hydroshare/">RENCI computing facility</a>. This document outlines how someone can interact with the interface.</p>
<div id="tldr" class="section level2">
<h2 class="hasAnchor">
<a href="#tldr" class="anchor"></a>TL;DR</h2>
<p>This package allows you to rapidly extract streamflow data from the reanalysis National Water Model products by NHD Catchment Identifier or USGS NWIS stream gage:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nwmHistoric</span>)

<span class="no">flows</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">siteNumber</span> <span class="kw">=</span> <span class="fl">11120000</span>)
<span class="no">flows</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">101</span>,<span class="fl">17595383</span>))</pre></body></html></div>
</div>
<div id="extracting-data-by-location" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-data-by-location" class="anchor"></a>Extracting data by location</h2>
<p>Reanalysis data can be accessed with the <code>readNWMdata</code> function. The API allows users to specify forecast location by either NHD Catchment Identifier(s) (COMID), or as an NWIS gage ID(s). Examples for each follow:</p>
<div id="nhd-catchment-identifier-comid" class="section level3">
<h3 class="hasAnchor">
<a href="#nhd-catchment-identifier-comid" class="anchor"></a>NHD Catchment Identifier (COMID)</h3>
<p>NWM reanalysis data can be extracted by NHD Catchment Identifier(s). The following code pulls the complete reanalysis data archive for COMID 17595383, a NHD reach near Goleta, California.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">flows</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fl">17595383</span>)</pre></body></html></div>
<pre><code>#&gt;   model    comid                time flow
#&gt; 1  NWM2 17595383 1993-01-01 00:00:00 0.21
#&gt; 2  NWM2 17595383 1993-01-01 01:00:00 0.21
#&gt; 3  NWM2 17595383 1993-01-01 02:00:00 0.21
#&gt; 4  NWM2 17595383 1993-01-01 03:00:00 0.21
#&gt; 5  NWM2 17595383 1993-01-01 04:00:00 0.21
#&gt; 6  NWM2 17595383 1993-01-01 05:00:00 0.21</code></pre>
</div>
</div>
<div id="usgs-nwis-site-number" class="section level2">
<h2 class="hasAnchor">
<a href="#usgs-nwis-site-number" class="anchor"></a>USGS NWIS Site Number</h2>
<p>Alternatively, data can be extracted using USGS NWIS sit number(s).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">flows</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">siteNumber</span>  <span class="kw">=</span> <span class="st">'11120000'</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">flows</span>)
<span class="co">#&gt;   model    comid                time flow siteNumber</span>
<span class="co">#&gt; 1  NWM2 17595429 1993-01-01 00:00:00 0.41   11120000</span>
<span class="co">#&gt; 2  NWM2 17595429 1993-01-01 01:00:00 0.41   11120000</span>
<span class="co">#&gt; 3  NWM2 17595429 1993-01-01 02:00:00 0.41   11120000</span>
<span class="co">#&gt; 4  NWM2 17595429 1993-01-01 03:00:00 0.41   11120000</span>
<span class="co">#&gt; 5  NWM2 17595429 1993-01-01 04:00:00 0.42   11120000</span>
<span class="co">#&gt; 6  NWM2 17595429 1993-01-01 05:00:00 0.42   11120000</span></pre></body></html></div>
</div>
<div id="date-range" class="section level2">
<h2 class="hasAnchor">
<a href="#date-range" class="anchor"></a>Date Range</h2>
<p>By default, the API extracts the complete flow record for each input location. This range can subset by providing a startDate and endDate in the form of (“YYYY-MM-DD”). Below is an example of getting the flow records for January 2010 at the same COMID as above:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">flows_utc</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fl">17595383</span>,
                    <span class="kw">startDate</span> <span class="kw">=</span> <span class="st">"2010-01-01"</span>, <span class="kw">endDate</span> <span class="kw">=</span> <span class="st">"2010-01-31"</span>)

<span class="co"># Check time diminsions</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">flows_utc</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "2010-01-01 UTC"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">flows_utc</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "2010-01-31 23:00:00 UTC"</span>
<span class="fu">tz</span>(<span class="no">flows_utc</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "UTC"</span></pre></body></html></div>
</div>
<div id="time-zones" class="section level2">
<h2 class="hasAnchor">
<a href="#time-zones" class="anchor"></a>Time-zones</h2>
<p>NWM output is recorded as a dateTime in UTC. To request data in a different time zone users can request a timezone to return data for.</p>
<p>In this example we are looking for the October 2010 flows in Goleta, California so we request the data in US/Pacific time.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">flows_pst</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fl">17595383</span>,
                    <span class="kw">startDate</span> <span class="kw">=</span> <span class="st">"2010-01-01"</span>, <span class="kw">endDate</span> <span class="kw">=</span> <span class="st">"2010-01-31"</span>,
                    <span class="kw">tz</span> <span class="kw">=</span> <span class="st">"US/Pacific"</span>)

<span class="co"># Check time diminsions</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">flows_pst</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "2010-01-01 PST"</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">flows_pst</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "2010-01-31 23:00:00 PST"</span>
<span class="fu">tz</span>(<span class="no">flows_pst</span>$<span class="no">time</span>)
<span class="co">#&gt; [1] "US/Pacific"</span>

<span class="co"># Ensure UTC and PST extracts are equal length</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">flows_pst</span>) <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">flows_utc</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>Finally, we can plot the UTC return against the PST return:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">flows_utc</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">flow</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"UTC"</span>)) +
  <span class="fu">geom_line</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">flows_pst</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">flows_utc</span>$<span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">flow</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"PST"</span>)) +
  <span class="fu">theme_minimal</span>() +
  <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"UTC"</span> <span class="kw">=</span> <span class="st">"blue"</span>,<span class="st">"PST"</span> <span class="kw">=</span> <span class="st">"red"</span>), <span class="kw">guide</span> <span class="kw">=</span> <span class="fu">guide_legend</span>(<span class="kw">override.aes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">linetype</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"solid"</span>, <span class="st">"solid"</span>), <span class="kw">shape</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">NA</span>))))+
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Flows'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"DateTime"</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Time Zone Comparison"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Timezone"</span>) + <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="API_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div id="model-version" class="section level2">
<h2 class="hasAnchor">
<a href="#model-version" class="anchor"></a>Model Version</h2>
<p>The reanalysis product for versions 1.2 and 2.0 of the reanalysis product are available. By default the API extracts data from version 2.0, but data from 1.2 can be requested using the version parameter.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">flows12</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fl">17595383</span>,
                      <span class="kw">startDate</span>   <span class="kw">=</span> <span class="st">"2010-01-01"</span>,
                      <span class="kw">endDate</span> <span class="kw">=</span> <span class="st">"2010-01-31"</span>,
                      <span class="kw">tz</span> <span class="kw">=</span> <span class="st">"US/Pacific"</span>,
                      <span class="kw">version</span> <span class="kw">=</span>  <span class="fl">1.2</span>)</pre></body></html></div>
<p>Finally lets plot the v1.2 vs v2.0 data to see what differences these two models exhibit at COMID 101:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">flows12</span>,   <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">flow</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"v1.2"</span>)) +
  <span class="fu">geom_line</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">flows_utc</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">flow</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"v2.0"</span>)) +
  <span class="fu">theme_minimal</span>() +
  <span class="fu">scale_colour_manual</span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"v1.2"</span> <span class="kw">=</span> <span class="st">"blue"</span>,<span class="st">"v2.0"</span> <span class="kw">=</span> <span class="st">"red"</span>),
        <span class="kw">guide</span> <span class="kw">=</span> <span class="fu">guide_legend</span>(
          <span class="kw">override.aes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">linetype</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"solid"</span>, <span class="st">"solid"</span>),
                              <span class="kw">shape</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">NA</span>))))+
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Flows'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"DateTime"</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">"Model Comparison"</span>,
       <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Model"</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="API_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
</div>
<div id="year-month-day-hour-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#year-month-day-hour-visualization" class="anchor"></a>Year-Month-Day-Hour Visualization</h2>
<p>Being able to extract hourly data has some advantages and cool opportunities for visualizing data. Lets extract some data to play with:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">vizflow</span> <span class="kw">=</span> <span class="fu"><a href="../reference/readNWMdata.html">readNWMdata</a></span>(<span class="kw">comid</span> <span class="kw">=</span> <span class="fl">101</span>,
                       <span class="kw">startDate</span> <span class="kw">=</span> <span class="st">"2014-01-01"</span>,
                       <span class="kw">endDate</span> <span class="kw">=</span> <span class="st">'2016-12-31'</span>)</pre></body></html></div>
<div id="split-time" class="section level3">
<h3 class="hasAnchor">
<a href="#split-time" class="anchor"></a>Split-time</h3>
<p>For most plotting efforts we will want to organize time aggregates of the raw data (e.g. by year, by-month…). The <code>nwmHistoric</code> package provides a function for splitting the hourly dateTime objects of a nwm data.frame into it temporal components. In addition to the basic Year, Month,Day, and Hour, the season, water year, and Day-of-Water Year (DOWY) are added:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">st</span> <span class="kw">=</span> <span class="fu"><a href="../reference/split_time.html">split_time</a></span>(<span class="no">vizflow</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">st</span>)
<span class="co">#&gt;   model comid                time       flow year month day hour season   wy</span>
<span class="co">#&gt; 1  NWM2   101 2014-01-01 00:00:00 0.09999999 2014     1   1    0 Winter 2014</span>
<span class="co">#&gt; 2  NWM2   101 2014-01-01 01:00:00 0.09999999 2014     1   1    1 Winter 2014</span>
<span class="co">#&gt; 3  NWM2   101 2014-01-01 02:00:00 0.09999999 2014     1   1    2 Winter 2014</span>
<span class="co">#&gt; 4  NWM2   101 2014-01-01 03:00:00 0.09999999 2014     1   1    3 Winter 2014</span>
<span class="co">#&gt; 5  NWM2   101 2014-01-01 04:00:00 0.09999999 2014     1   1    4 Winter 2014</span>
<span class="co">#&gt; 6  NWM2   101 2014-01-01 05:00:00 0.09999999 2014     1   1    5 Winter 2014</span>
<span class="co">#&gt;   julian DOWY</span>
<span class="co">#&gt; 1      1   93</span>
<span class="co">#&gt; 2      1   93</span>
<span class="co">#&gt; 3      1   93</span>
<span class="co">#&gt; 4      1   93</span>
<span class="co">#&gt; 5      1   93</span>
<span class="co">#&gt; 6      1   93</span></pre></body></html></div>
<p>Using the time attributes of the “split” time elements we can plot the hourly flow records by water-year:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="kw">data</span><span class="kw">=</span><span class="no">st</span>,) +
  <span class="fu">geom_line</span>( <span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="no">DOWY</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">flow</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">flow</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu">scale_color_viridis_c</span>() +
  <span class="fu">facet_grid</span>(<span class="no">wy</span>~<span class="no">.</span>) +
  <span class="fu">labs</span>(<span class="kw">y</span><span class="kw">=</span><span class="st">"Daily Flow (cms)"</span>,
       <span class="kw">x</span><span class="kw">=</span> <span class="st">"Day of Water Year"</span>,
       <span class="kw">title</span><span class="kw">=</span><span class="st">"Hourly Discharge for COMID 101"</span>) +
  <span class="fu">theme_minimal</span>()</pre></body></html></div>
<p><img src="API_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>Alternatively we can plot the hourly streamflow conditions as a heat-map grouped by day, month and year. (Adopted from <a href="https://www.r-graph-gallery.com/283-the-hourly-heatmap.html">here</a>)</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="no">st</span>,<span class="fu">aes</span>(<span class="no">day</span>,<span class="no">hour</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">flow</span>))+
  <span class="fu">geom_tile</span>(<span class="kw">color</span><span class="kw">=</span> <span class="st">"transparent"</span>,<span class="kw">size</span><span class="kw">=</span><span class="fl">0.1</span>) +
  <span class="fu">scale_fill_viridis</span>(<span class="kw">name</span><span class="kw">=</span><span class="st">"Hourly Flows cms"</span>,<span class="kw">option</span> <span class="kw">=</span><span class="st">"C"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.8</span>) +
  <span class="fu">facet_grid</span>(<span class="no">year</span>~<span class="no">month</span>) +
  <span class="fu">scale_y_continuous</span>(<span class="kw">trans</span> <span class="kw">=</span> <span class="st">"reverse"</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">st</span>$<span class="no">hour</span>)) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">breaks</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">31</span>)) +
  <span class="fu">theme_minimal</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">8</span>) +
  <span class="fu">labs</span>(<span class="kw">title</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Hourly Flows - COMID"</span>,<span class="no">st</span>$<span class="no">comid</span>[<span class="fl">1</span>]), <span class="kw">x</span><span class="kw">=</span><span class="st">"Day"</span>, <span class="kw">y</span><span class="kw">=</span><span class="st">"Hour"</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)+
  <span class="fu">theme</span>(<span class="kw">plot.title</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">14</span>))+
  <span class="fu">theme</span>(<span class="kw">axis.text.y</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">6</span>)) +
  <span class="fu">theme</span>(<span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_rect</span>(<span class="kw">colour</span><span class="kw">=</span><span class="st">"white"</span>))+
  <span class="fu">theme</span>(<span class="kw">plot.title</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">hjust</span><span class="kw">=</span><span class="fl">0</span>))+
  <span class="fu">theme</span>(<span class="kw">axis.ticks</span><span class="kw">=</span><span class="fu">element_blank</span>())+
  <span class="fu">theme</span>(<span class="kw">axis.text</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">7</span>))+
  <span class="fu">theme</span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">8</span>))+
  <span class="fu">theme</span>(<span class="kw">legend.text</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">6</span>))</pre></body></html></div>
<p><img src="API_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<p>In section 2 we will look at how we can automate COMID and USGS NWIS discovery. In section three we will look at some techniques to capitalize of the <code>split_time</code> time elements using the <code>aggregation_*</code> family of functions.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer></footer>
</div>

  


  </body>
</html>
